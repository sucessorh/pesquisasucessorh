<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisa de Satisfação - Sucesso RH</title>

    <!-- Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Chart.js for Dashboards -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

    <!-- Custom Styles & Theme -->
    <style>
        :root {
            --azul-escuro: #1C4D96;
            --azul-medio: #266EDB;
            --cinza-texto: #374151;
            --cinza-claro: #f3f4f6;
        }
        body {
            font-family: 'Inter', sans-serif;
            color: var(--cinza-texto);
            background-color: var(--cinza-claro);
        }
        h1, h2, h3, .font-title {
            font-family: 'Poppins', sans-serif;
            color: var(--azul-escuro);
        }
        .bg-azul-escuro { background-color: var(--azul-escuro); }
        .bg-azul-medio { background-color: var(--azul-medio); }
        .text-azul-escuro { color: var(--azul-escuro); }
        .text-azul-medio { color: var(--azul-medio); }
        .border-azul-medio { border-color: var(--azul-medio); }
        .ring-azul-medio { --tw-ring-color: var(--azul-medio); }

        /* New Aurora Background Animation */
        .animated-aurora-gradient {
            background: linear-gradient(125deg, var(--azul-escuro), var(--azul-medio), #1E3A8A);
            background-size: 400% 400%;
            animation: gradient-flow 16s ease infinite;
        }
        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Modal Popup Animation */
        .modal-popup {
            animation: popup 0.3s ease-out forwards;
        }
        @keyframes popup {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 20px;
            border: 3px solid #f1f5f9;
        }

        /* NPS Scale Styling */
        .nps-scale {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .nps-scale label {
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #e5e7eb;
            border-radius: 50%;
            transition: all 0.2s ease;
            font-weight: 600;
        }
        .nps-scale input[type="radio"] {
            display: none;
        }
        .nps-scale input[type="radio"]:checked + span {
            background-color: var(--azul-medio);
            color: white;
            border-color: var(--azul-medio);
            transform: scale(1.1);
        }
    </style>
</head>
<body class="antialiased">

    <!-- Global Error Banner -->
    <div id="error-banner" class="hidden sticky top-0 left-0 right-0 bg-red-600 text-white text-center p-2 z-50">
        <span id="error-banner-message"></span>
        <button onclick="this.parentElement.classList.add('hidden')" class="absolute top-1/2 right-4 -translate-y-1/2 font-bold">X</button>
    </div>

    <!-- =================================================================== -->
    <!-- ====                  PUBLIC VIEW (HERO & FORMS)                 ==== -->
    <!-- =================================================================== -->
    <div id="public-view" class="flex flex-col min-h-screen">
        <!-- Hero Section -->
        <header id="hero-section" class="animated-aurora-gradient relative w-full flex-grow flex flex-col items-center justify-center text-white">
            <!-- Admin Access Icon -->
            <div class="absolute top-6 right-6 z-20">
                <button id="open-admin-login-btn" class="p-2 rounded-full text-white/70 hover:text-white hover:bg-white/10 transition-colors" aria-label="Acessar painel do administrador">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                </button>
            </div>
            
            <!-- Hero Content -->
            <div id="hero-content" class="relative z-10 text-center p-6 transition-opacity duration-300">
                <img src="https://i.postimg.cc/hGJpz4hc/Design-sem-nome-1.png" alt="Logotipo Sucesso RH" class="h-20 w-auto mx-auto mb-8">
                
                <h1 class="text-4xl md:text-5xl font-bold text-white drop-shadow-lg">Pesquisa de Satisfação</h1>
                <p class="text-lg md:text-xl text-white/80 mt-4 max-w-3xl mx-auto drop-shadow-md">Com a sua opinião, moldamos um futuro de sucesso, juntos!</p>
                <div class="mt-10 flex flex-col sm:flex-row items-center justify-center gap-4">
                    <button data-modal="satisfaction-modal" class="open-modal-btn w-full sm:w-auto text-lg font-semibold bg-white text-azul-escuro px-8 py-3 rounded-full shadow-lg transition-transform hover:scale-105">
                        Iniciar Pesquisa
                    </button>
                     <button data-modal="praise-modal" class="open-modal-btn w-full sm:w-auto text-lg font-semibold bg-white text-azul-escuro px-8 py-3 rounded-full shadow-lg transition-transform hover:scale-105">
                        Elogiômetro
                    </button>
                    <a href="https://sucessorh.github.io/ouvidoriasucessorh" target="_blank" rel="noopener noreferrer" class="inline-block w-full sm:w-auto text-lg font-semibold bg-white text-azul-escuro px-8 py-3 rounded-full shadow-lg transition-transform hover:scale-105">
                        Canal de Ouvidoria
                    </a>
                </div>
            </div>
        </header>

        <!-- Footer -->
        <footer class="bg-azul-escuro text-white/80 py-6">
            <div class="container mx-auto px-6 text-center">
                <div class="flex flex-col items-center gap-4">
                     <div class="flex items-center gap-6">
                        <a href="https://instagram.com/sucessorecursoshumanos" target="_blank" class="text-white/70 hover:text-white transition-colors" aria-label="Instagram">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                        </a>
                     </div>
                </div>
                <p class="text-xs text-white/50 mt-4">
                    &copy; 2025 Sucesso RH. Todos os direitos reservados.
                </p>
            </div>
        </footer>
    </div>

    <!-- =================================================================== -->
    <!-- ====                  ADMIN DASHBOARD VIEW                     ==== -->
    <!-- =================================================================== -->
    <div id="admin-dashboard" class="hidden min-h-screen bg-slate-100 p-4 sm:p-6 lg:p-8">
        <!-- Admin content will be dynamically generated by JS -->
    </div>

    <!-- =================================================================== -->
    <!-- ====                       MODALS & TOASTS                     ==== -->
    <!-- =================================================================== -->

    <!-- Form Modal: Pesquisa de Satisfação -->
    <div id="satisfaction-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <form id="satisfaction-form-element" class="modal-popup bg-white p-8 md:p-10 rounded-2xl shadow-xl border border-gray-100 space-y-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto custom-scrollbar">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-azul-escuro">Pesquisa de Satisfação – Sucesso RH</h2>
                <p class="mt-2 text-gray-600 max-w-2xl mx-auto">Sua opinião é essencial para que a Sucesso RH continue oferecendo um atendimento de qualidade, ético e eficiente. Todas as respostas são confidenciais e ajudam a melhorar nossos serviços.</p>
            </div>
            
            <div class="space-y-5">
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">1. Como você avalia a cordialidade no atendimento da Sucesso RH? <span class="text-red-500">*</span></p>
                    <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="cordialidade" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">1 – Muito Insatisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="cordialidade" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">2 – Insatisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="cordialidade" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">3 – Razoável</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="cordialidade" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">4 – Satisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="cordialidade" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">5 – Muito Satisfeito</span></label>
                    </div>
                </div>
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">2. As solicitações enviadas à Sucesso RH são respondidas com agilidade? <span class="text-red-500">*</span></p>
                    <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="agilidade" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">1 – Muito Insatisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="agilidade" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">2 – Insatisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="agilidade" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">3 – Razoável</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="agilidade" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">4 – Satisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="agilidade" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">5 – Muito Satisfeito</span></label>
                    </div>
                </div>
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">3. A Sucesso RH cumpre os prazos informados para resolver suas solicitações? <span class="text-red-500">*</span></p>
                    <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="cumprimento_prazos" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">1 – Muito Insatisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="cumprimento_prazos" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">2 – Insatisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="cumprimento_prazos" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">3 – Razoável</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="cumprimento_prazos" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">4 – Satisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="cumprimento_prazos" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">5 – Muito Satisfeito</span></label>
                    </div>
                </div>
                 <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">4. Você sente que a equipe da Sucesso RH está disponível quando precisa de atendimento? <span class="text-red-500">*</span></p>
                    <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="disponibilidade" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">1 – Muito Insatisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="disponibilidade" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">2 – Insatisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="disponibilidade" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">3 – Razoável</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="disponibilidade" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">4 – Satisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="disponibilidade" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">5 – Muito Satisfeito</span></label>
                    </div>
                </div>
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">5. A Sucesso RH demonstra comprometimento em resolver suas demandas? <span class="text-red-500">*</span></p>
                    <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="comprometimento" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">1 – Muito Insatisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="comprometimento" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">2 – Insatisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="comprometimento" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">3 – Razoável</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="comprometimento" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">4 – Satisfeito</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer"><input type="radio" name="comprometimento" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">5 – Muito Satisfeito</span></label>
                    </div>
                </div>
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700 text-center">6. Qual é o seu nível geral de satisfação com a Sucesso RH? <span class="text-red-500">*</span></p>
                    <div class="nps-scale mt-3">
                        <script>
                            for(let i = 0; i <= 10; i++) {
                                document.write(`<label><input type="radio" name="nps_geral" value="${i}" required><span class="nps-scale-item">${i}</span></label>`);
                            }
                        </script>
                    </div>
                </div>
            </div>

            <div>
                <label for="comentarios-sugestoes" class="font-semibold text-gray-700">7. Comentários ou sugestões para melhoria (opcional)</label>
                <textarea id="comentarios-sugestoes" rows="3" class="mt-1 block w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-medio focus:border-azul-medio"></textarea>
            </div>
            
            <div class="flex justify-end gap-4 items-center pt-4 border-t border-gray-200">
                <button type="button" class="close-modal-btn font-semibold text-gray-600 hover:text-gray-900">Cancelar</button>
                <button type="submit" class="text-lg font-semibold bg-azul-medio text-white px-8 py-2 rounded-full shadow-lg transition-transform hover:scale-105 disabled:opacity-50 disabled:cursor-wait flex items-center justify-center gap-2">
                    <span class="spinner hidden w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
                    Enviar Avaliação
                </button>
            </div>
        </form>
    </div>

    <!-- Praise Form Modal -->
    <div id="praise-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <form id="praise-form-element" class="modal-popup bg-white p-8 md:p-12 rounded-2xl shadow-xl border border-gray-100 space-y-8 w-full max-w-lg">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-azul-escuro">Elogiômetro Sucesso RH</h2>
                <p class="mt-2 text-gray-600">Valorize quem faz a diferença!</p>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label for="praise-author" class="font-semibold text-gray-700">Seu nome (opcional)</label>
                    <input type="text" id="praise-author" class="mt-1 block w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-medio focus:border-azul-medio">
                </div>
                <div>
                    <label for="praise-recipient" class="font-semibold text-gray-700">Nome do colaborador elogiado <span class="text-red-500">*</span></label>
                    <input type="text" id="praise-recipient" required class="mt-1 block w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-medio focus:border-azul-medio">
                </div>
                <div>
                    <label for="praise-message" class="font-semibold text-gray-700">Seu elogio <span class="text-red-500">*</span></label>
                    <textarea id="praise-message" rows="5" required class="mt-1 block w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-medio focus:border-azul-medio"></textarea>
                </div>
            </div>
            
            <div class="flex justify-end gap-4 items-center pt-4 border-t border-gray-200">
                <button type="button" class="close-modal-btn font-semibold text-gray-600 hover:text-gray-900">Cancelar</button>
                <button type="submit" class="text-lg font-semibold bg-azul-medio text-white px-8 py-2 rounded-full shadow-lg transition-transform hover:scale-105 disabled:opacity-50 disabled:cursor-wait flex items-center justify-center gap-2">
                    <span class="spinner hidden w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
                    Enviar Elogio
                </button>
            </div>
        </form>
    </div>

    <!-- Thank You Modal -->
    <div id="thank-you-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <div class="modal-popup bg-white rounded-2xl shadow-2xl w-full max-w-md text-center p-8">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-5">
                <svg class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>
            </div>
            <h2 class="text-2xl font-bold text-slate-800">Obrigado!</h2>
            <p id="thank-you-message" class="text-slate-600 mt-2 mb-6">Sua opinião foi enviada com sucesso.</p>
            <button class="close-modal-btn w-full bg-azul-medio text-white font-bold px-6 py-3 rounded-lg hover:bg-azul-escuro transition-colors">Fechar</button>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="admin-login-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <form id="admin-login-form" class="modal-popup bg-white rounded-2xl shadow-2xl w-full max-w-sm">
            <div class="p-8">
                <h2 class="text-2xl font-bold text-center text-azul-escuro">Acesso Restrito</h2>
                <p class="text-slate-500 text-center mt-2">Insira a senha de administrador.</p>
                <div class="mt-6">
                    <label for="admin-password" class="font-semibold text-slate-700 block mb-1">Senha</label>
                    <input type="password" id="admin-password" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-azul-medio focus:border-azul-medio">
                    <p id="admin-error" class="text-red-500 text-sm mt-1 hidden">Senha incorreta.</p>
                </div>
                <div class="mt-6 flex items-center justify-end gap-4">
                    <button type="button" class="close-modal-btn font-semibold text-slate-600 hover:text-slate-800">Cancelar</button>
                    <button type="submit" class="bg-azul-medio text-white font-bold px-6 py-2 rounded-lg hover:bg-azul-escuro transition-colors">Entrar</button>
                </div>
            </div>
        </form>
    </div>

    <!-- =================================================================== -->
    <!-- ====                  JAVASCRIPT & FIREBASE                    ==== -->
    <!-- =================================================================== -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // =================================================
        // ===        CREDENCIAIS DO FIREBASE            ===
        // =================================================
        const firebaseConfig = {
          apiKey: "AIzaSyDZdgCapcV-MT-ecMnbBY9BM1rK4MJ6fLU",
          authDomain: "psexternasucessorh.firebaseapp.com",
          projectId: "psexternasucessorh",
          storageBucket: "psexternasucessorh.firebasestorage.app",
          messagingSenderId: "110739482539",
          appId: "1:110739482539:web:6223efe2f79a551a14d4ee",
          measurementId: "G-73B95D0RYB"
        };
        
        // --- DOM Elements ---
        const publicView = document.getElementById('public-view');
        const adminDashboardContainer = document.getElementById('admin-dashboard');
        
        // Modals & Buttons
        const thankYouModal = document.getElementById('thank-you-modal');
        const adminLoginModal = document.getElementById('admin-login-modal');
        const adminLoginForm = document.getElementById('admin-login-form');
        const satisfactionForm = document.getElementById('satisfaction-form-element');
        const praiseForm = document.getElementById('praise-form-element');
        const openAdminLoginBtn = document.getElementById('open-admin-login-btn');
        const openModalBtns = document.querySelectorAll('.open-modal-btn');
        const closeModalBtns = document.querySelectorAll('.close-modal-btn');

        // Error Banner
        const errorBanner = document.getElementById('error-banner');
        const errorBannerMessage = document.getElementById('error-banner-message');

        function showError(message) {
            errorBannerMessage.textContent = message;
            errorBanner.classList.remove('hidden');
        }

        // --- Firebase Initialization ---
        const isConfigured = firebaseConfig.apiKey && firebaseConfig.apiKey.startsWith("AIza");
        let db, auth;

        if (!isConfigured) {
            showError("CONFIGURAÇÃO NECESSÁRIA: Insira suas credenciais do Firebase no código para a aplicação funcionar.");
        } else {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                signInAnonymously(auth).catch((error) => {
                    console.error("Anonymous sign-in failed:", error);
                    showError("Falha na autenticação. Verifique as regras de segurança do Firebase.");
                });
            } catch (e) {
                console.error("Firebase initialization error:", e);
                showError("Erro ao inicializar o Firebase. Verifique sua configuração.");
            }
        }
        
        // --- UI Logic & Modal Controls ---
        const openModal = (modal) => modal.classList.remove('hidden');
        const closeModal = (modal) => modal.classList.add('hidden');

        openModalBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const modalId = btn.dataset.modal;
                const modal = document.getElementById(modalId);
                if (modal) openModal(modal);
            });
        });
        
        closeModalBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const modal = e.target.closest('.fixed');
                if(modal) closeModal(modal);
            });
        });

        openAdminLoginBtn.addEventListener('click', () => openModal(adminLoginModal));

        // --- Form Submission ---
        async function handleFormSubmission(form, collectionName, dataExtractor, successMessage) {
            if (!isConfigured) {
                showError("O formulário não pode ser enviado sem a configuração do Firebase.");
                return;
            }

            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.querySelector('.spinner').classList.remove('hidden');

            try {
                const formData = dataExtractor(form);
                await addDoc(collection(db, collectionName), formData);
                closeModal(form.closest('.fixed'));
                form.reset();
                document.getElementById('thank-you-message').textContent = successMessage;
                openModal(thankYouModal);
            } catch (error) {
                console.error(`Error adding document to ${collectionName}: `, error);
                showError("Ocorreu um erro ao enviar sua resposta. Tente novamente.");
            } finally {
                submitBtn.disabled = false;
                submitBtn.querySelector('.spinner').classList.add('hidden');
            }
        }

        satisfactionForm.addEventListener('submit', (e) => {
            e.preventDefault();
            handleFormSubmission(satisfactionForm, 'pesquisa_satisfacao_simplificada', form => ({
                createdAt: serverTimestamp(),
                cordialidade: parseInt(form.querySelector('input[name="cordialidade"]:checked').value),
                agilidade: parseInt(form.querySelector('input[name="agilidade"]:checked').value),
                cumprimento_prazos: parseInt(form.querySelector('input[name="cumprimento_prazos"]:checked').value),
                disponibilidade: parseInt(form.querySelector('input[name="disponibilidade"]:checked').value),
                comprometimento: parseInt(form.querySelector('input[name="comprometimento"]:checked').value),
                nps_geral: parseInt(form.querySelector('input[name="nps_geral"]:checked').value),
                comentarios: form.querySelector('#comentarios-sugestoes').value.trim(),
            }), 'Sua avaliação foi enviada com sucesso. Agradecemos sua contribuição!');
        });
        
        praiseForm.addEventListener('submit', (e) => {
            e.preventDefault();
            handleFormSubmission(praiseForm, 'elogios', form => ({
                createdAt: serverTimestamp(),
                autor: form.querySelector('#praise-author').value.trim() || 'Anônimo',
                elogiado: form.querySelector('#praise-recipient').value.trim(),
                mensagem: form.querySelector('#praise-message').value.trim(),
            }), 'Seu elogio foi enviado! Obrigado por reconhecer quem faz a diferença.');
        });

        // --- Admin Logic ---
        let allSurveyData = [];
        let allPraiseData = [];
        let filteredSurveyData = [];
        let filteredPraiseData = [];
        let chartInstances = {};

        function renderAdminDashboard() {
            adminDashboardContainer.innerHTML = `
                <div class="max-w-7xl mx-auto">
                    <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                        <h1 class="text-3xl font-bold text-slate-800">Dashboard de Satisfação</h1>
                        <button id="logout-btn" class="font-semibold text-azul-medio hover:text-azul-escuro transition-colors">Sair</button>
                    </div>

                    <!-- Filters -->
                    <div class="bg-white p-4 rounded-xl shadow-sm mb-6 flex flex-wrap gap-4 items-end">
                        <div>
                            <label for="date-start" class="text-sm font-medium text-gray-600">Data Início</label>
                            <input type="date" id="date-start" class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-medio">
                        </div>
                        <div>
                            <label for="date-end" class="text-sm font-medium text-gray-600">Data Fim</label>
                            <input type="date" id="date-end" class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-medio">
                        </div>
                        <button id="filter-btn" class="bg-azul-medio text-white px-4 py-2 rounded-lg font-semibold hover:bg-azul-escuro transition">Filtrar</button>
                        <button id="clear-filter-btn" class="bg-gray-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-gray-600 transition">Limpar Filtro</button>
                    </div>

                    <!-- Section: Pesquisa de Satisfação -->
                    <section class="mb-8 bg-white p-6 rounded-xl shadow-sm">
                        <div class="flex justify-between items-center mb-4 border-b-2 border-azul-medio pb-2">
                            <h2 class="text-2xl font-bold text-slate-700">Resultados da Pesquisa</h2>
                            <button id="export-csv-btn" class="bg-gray-200 text-sm text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300">Exportar CSV</button>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="lg:col-span-2">
                                <h3 class="font-bold text-lg text-slate-700 mb-4">Distribuição das Avaliações</h3>
                                <div class="h-96"><canvas id="satisfaction-distribution-chart"></canvas></div>
                            </div>
                            <div class="lg:col-span-2">
                                <h3 class="font-bold text-lg text-slate-700 mb-4">NPS - Satisfação Geral</h3>
                                <div id="nps-score" class="text-5xl font-bold text-center text-azul-escuro my-4"></div>
                                <div class="h-60"><canvas id="nps-chart"></canvas></div>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg text-slate-700 mb-4">Comentários e Sugestões</h3>
                            <div id="comments-list" class="h-72 overflow-y-auto custom-scrollbar space-y-3 pr-2 border p-2 rounded-md"></div>
                        </div>
                    </section>
                    
                    <!-- Section: Elogiômetro -->
                     <section class="bg-white p-6 rounded-xl shadow-sm">
                        <div class="flex justify-between items-center mb-4 border-b-2 border-azul-escuro pb-2">
                            <h2 class="text-2xl font-bold text-slate-700">Elogiômetro</h2>
                        </div>
                        <div>
                            <div id="praises-list" class="h-96 overflow-y-auto custom-scrollbar space-y-4 pr-2"></div>
                        </div>
                    </section>
                </div>
            `;
            addAdminEventListeners();
        }

        function addAdminEventListeners() {
            document.getElementById('logout-btn').addEventListener('click', () => {
                publicView.classList.remove('hidden');
                adminDashboardContainer.classList.add('hidden');
                adminDashboardContainer.innerHTML = '';
                Object.values(chartInstances).forEach(chart => chart.destroy());
            });

            document.getElementById('filter-btn').addEventListener('click', applyFilters);
            document.getElementById('clear-filter-btn').addEventListener('click', clearFilters);
            document.getElementById('export-csv-btn').addEventListener('click', () => exportToCSV(filteredSurveyData));
        }

        adminLoginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const password = document.getElementById('admin-password').value;
            const errorMsg = document.getElementById('admin-error');
            if (password === 'SucessoRH@2025') { 
                publicView.classList.add('hidden');
                adminDashboardContainer.classList.remove('hidden');
                closeModal(adminLoginModal);
                adminLoginForm.reset();
                errorMsg.classList.add('hidden');
                renderAdminDashboard();
                initializeDashboard();
            } else {
                errorMsg.classList.add('hidden');
            }
        });

        function initializeDashboard() {
            if (!isConfigured) return;
            
            onSnapshot(query(collection(db, "pesquisa_satisfacao_simplificada"), orderBy("createdAt", "desc")), (snapshot) => {
                allSurveyData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                applyFilters();
            });
            
            onSnapshot(query(collection(db, "elogios"), orderBy("createdAt", "desc")), (snapshot) => {
                allPraiseData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                applyFilters();
            });
        }

        function applyFilters() {
            const startDate = document.getElementById('date-start').value;
            const endDate = document.getElementById('date-end').value;

            const start = startDate ? new Date(startDate) : null;
            if(start) start.setHours(0, 0, 0, 0);

            const end = endDate ? new Date(endDate) : null;
            if(end) end.setHours(23, 59, 59, 999);

            filteredSurveyData = allSurveyData.filter(item => {
                const itemDate = item.createdAt?.toDate();
                if (!itemDate) return false;
                if (start && itemDate < start) return false;
                if (end && itemDate > end) return false;
                return true;
            });
            
            filteredPraiseData = allPraiseData.filter(item => {
                const itemDate = item.createdAt?.toDate();
                if (!itemDate) return false;
                if (start && itemDate < start) return false;
                if (end && itemDate > end) return false;
                return true;
            });
            
            updateDashboard();
        }

        function clearFilters() {
            document.getElementById('date-start').value = '';
            document.getElementById('date-end').value = '';
            applyFilters();
        }

        function updateDashboard() {
            if (adminDashboardContainer.classList.contains('hidden')) return;

            Object.values(chartInstances).forEach(chart => chart.destroy());

            renderSatisfactionDistributionChart(filteredSurveyData);
            renderNpsChart(filteredSurveyData);
            renderCommentsList(filteredSurveyData, 'comments-list', 'comentarios');
            renderPraisesList(filteredPraiseData);
        }

        const createChart = (ctx, type, data, options) => new Chart(ctx, { type, data, options });

        function renderSatisfactionDistributionChart(data) {
            const ctx = document.getElementById('satisfaction-distribution-chart')?.getContext('2d');
            if(!ctx) return;

            const questionKeys = ['cordialidade', 'agilidade', 'cumprimento_prazos', 'disponibilidade', 'comprometimento'];
            const questionLabels = ['Cordialidade', 'Agilidade', 'Prazos', 'Disponibilidade', 'Comprometimento'];
            const satisfactionLabels = ['1 - Muito Insatisfeito', '2 - Insatisfeito', '3 - Razoável', '4 - Satisfeito', '5 - Muito Satisfeito'];
            const satisfactionColors = ['#ef4444', '#f97316', '#facc15', '#84cc16', '#22c55e'];

            const datasets = satisfactionLabels.map((label, index) => {
                const rating = index + 1;
                return {
                    label: label,
                    data: questionKeys.map(key => data.filter(d => d[key] === rating).length),
                    backgroundColor: satisfactionColors[index],
                };
            });

            const chartData = {
                labels: questionLabels,
                datasets: datasets
            };

            chartInstances.distribution = createChart(ctx, 'bar', chartData, {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.x !== null) {
                                    label += context.parsed.x;
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        stacked: true,
                    },
                    y: {
                        stacked: true
                    }
                }
            });
        }

        function renderNpsChart(data) {
            const ctx = document.getElementById('nps-chart')?.getContext('2d');
            const scoreEl = document.getElementById('nps-score');
            if(!ctx || !scoreEl) return;

            const npsGroups = data.reduce((acc, item) => {
                const score = item.nps_geral;
                if (score >= 9) acc.promotores++;
                else if (score >= 7) acc.neutros++;
                else acc.detratores++;
                return acc;
            }, { promotores: 0, neutros: 0, detratores: 0 });

            const total = data.length;
            const npsScore = total > 0 ? Math.round(((npsGroups.promotores / total) - (npsGroups.detratores / total)) * 100) : 0;
            scoreEl.textContent = `${npsScore}`;
            
            const chartData = {
                labels: ['Detratores (0-6)', 'Neutros (7-8)', 'Promotores (9-10)'],
                datasets: [{
                    label: 'NPS',
                    data: [npsGroups.detratores, npsGroups.neutros, npsGroups.promotores],
                    backgroundColor: ['#EF5350', '#FFEE58', '#42A5F5'],
                    borderRadius: 5,
                }]
            };
            chartInstances.nps = createChart(ctx, 'bar', chartData, { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } });
        }
        
        function renderCommentsList(data, elementId, key) {
            const list = document.getElementById(elementId);
            if(!list) return;
            const filteredData = data.filter(item => item[key]);
            if (filteredData.length === 0) {
                list.innerHTML = `<p class="text-center text-gray-500">Nenhum registro encontrado.</p>`;
                return;
            }
            list.innerHTML = filteredData
                .map(item => `
                <div class="p-3 bg-slate-50 rounded-lg border border-slate-200">
                    <p class="text-gray-800">"${item[key]}"</p>
                    <div class="mt-2 text-xs text-right text-gray-500">
                        <span>${item.createdAt ? item.createdAt.toDate().toLocaleString('pt-BR') : 'N/A'}</span>
                    </div>
                </div>
            `).join('');
        }
        
        function renderPraisesList(praises) {
            const list = document.getElementById('praises-list');
            if(!list) return;
            if (praises.length === 0) {
                list.innerHTML = `<p class="text-center text-gray-500">Nenhum elogio encontrado.</p>`;
                return;
            }
            list.innerHTML = praises
                .map(p => `
                <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <p class="text-gray-800">"${p.mensagem}"</p>
                    <div class="mt-2 text-sm text-right">
                        <span class="font-semibold text-blue-800">Para: ${p.elogiado}</span>
                        <span class="text-gray-500"> | Por: ${p.autor}</span>
                    </div>
                </div>
            `).join('');
        }

        // --- Export Functions ---
        function exportToCSV(data) {
            const headers = "Data,Cordialidade,Agilidade,Cumprimento de Prazos,Disponibilidade,Comprometimento,NPS,Comentários";
            const rows = data.map(s => [
                s.createdAt ? s.createdAt.toDate().toLocaleString('pt-BR') : '',
                s.cordialidade, s.agilidade, s.cumprimento_prazos, s.disponibilidade, s.comprometimento,
                s.nps_geral,
                `"${(s.comentarios || '').replace(/"/g, '""')}"`
            ].join(','));
            
            downloadFile(headers + "\n" + rows.join("\n"), "relatorio_satisfacao.csv", "text/csv;charset=utf-8;");
        }

        function downloadFile(content, fileName, mimeType) {
            const link = document.createElement("a");
            const blob = new Blob([content], { type: mimeType });
            link.href = URL.createObjectURL(blob);
            link.setAttribute("download", fileName);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

    </script>
</body>
</html>

