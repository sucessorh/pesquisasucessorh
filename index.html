<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisa de Satisfação - Sucesso RH</title>

    <!-- Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Chart.js for Dashboards -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

    <!-- Custom Styles & Theme -->
    <style>
        :root {
            --azul-escuro: #0D47A1;
            --azul-medio: #1976D2;
            --cinza-texto: #374151;
            --cinza-claro: #f3f4f6;
        }
        body {
            font-family: 'Inter', sans-serif;
            color: var(--cinza-texto);
            background-color: var(--cinza-claro);
        }
        h1, h2, h3, .font-title {
            font-family: 'Poppins', sans-serif;
            color: var(--azul-escuro);
        }
        .bg-azul-escuro { background-color: var(--azul-escuro); }
        .bg-azul-medio { background-color: var(--azul-medio); }
        .text-azul-escuro { color: var(--azul-escuro); }
        .text-azul-medio { color: var(--azul-medio); }
        .border-azul-medio { border-color: var(--azul-medio); }
        .ring-azul-medio { --tw-ring-color: var(--azul-medio); }

        /* Adjusted Dynamic Background Animation */
        .animated-mesh-gradient {
            background-color: #e3f2fd;
            background-image:
                radial-gradient(at 15% 20%, hsl(210, 77%, 50%) 0, transparent 50%),
                radial-gradient(at 80% 75%, hsl(211, 85%, 40%) 0, transparent 50%);
            animation: gradient-move 12s ease-in-out infinite alternate;
            background-size: 200% 200%;
            background-position: 0% 0%;
        }
        @keyframes gradient-move {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        /* Modal Popup Animation */
        .modal-popup {
            animation: popup 0.3s ease-out forwards;
        }
        @keyframes popup {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 20px;
            border: 3px solid #f1f5f9;
        }

        /* NPS Scale Styling */
        .nps-scale {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .nps-scale label {
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #e5e7eb;
            border-radius: 50%;
            transition: all 0.2s ease;
            font-weight: 600;
        }
        .nps-scale input[type="radio"] {
            display: none;
        }
        .nps-scale input[type="radio"]:checked + span {
            background-color: var(--azul-medio);
            color: white;
            border-color: var(--azul-medio);
            transform: scale(1.1);
        }
    </style>
</head>
<body class="antialiased">

    <!-- Global Error Banner -->
    <div id="error-banner" class="hidden sticky top-0 left-0 right-0 bg-red-600 text-white text-center p-2 z-50">
        <span id="error-banner-message"></span>
        <button onclick="this.parentElement.classList.add('hidden')" class="absolute top-1/2 right-4 -translate-y-1/2 font-bold">X</button>
    </div>

    <!-- =================================================================== -->
    <!-- ====                  PUBLIC VIEW (HERO & FORMS)                 ==== -->
    <!-- =================================================================== -->
    <div id="public-view" class="flex flex-col min-h-screen">
        <!-- Hero Section -->
        <header id="hero-section" class="animated-mesh-gradient relative flex-grow w-full flex flex-col items-center justify-center overflow-hidden text-white">
            <!-- Admin Access Icon -->
            <div class="absolute top-6 right-6 z-20">
                <button id="open-admin-login-btn" class="p-2 rounded-full text-white/70 hover:text-white hover:bg-white/10 transition-colors" aria-label="Acessar painel do administrador">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                </button>
            </div>
            
            <!-- Hero Content -->
            <div id="hero-content" class="relative z-10 text-center p-6 transition-opacity duration-300">
                <img src="https://i.postimg.cc/hGJpz4hc/Design-sem-nome-1.png" alt="Logotipo Sucesso RH" class="h-20 w-auto mx-auto mb-8">
                
                <h1 class="text-4xl md:text-5xl font-bold text-white drop-shadow-lg">Pesquisa de Satisfação</h1>
                <p class="text-lg md:text-xl text-white/80 mt-4 max-w-3xl mx-auto drop-shadow-md">Sua voz é fundamental para a nossa melhoria contínua.</p>
                <div class="mt-10 flex flex-col sm:flex-row items-center justify-center gap-4">
                    <button data-modal="geral-servicos-modal" class="open-modal-btn w-full sm:w-auto text-lg font-semibold bg-white text-azul-escuro px-8 py-3 rounded-full shadow-lg transition-transform hover:scale-105">
                        Avaliação Geral dos Serviços
                    </button>
                    <button data-modal="atendimento-suporte-modal" class="open-modal-btn w-full sm:w-auto text-lg font-semibold bg-white text-azul-escuro px-8 py-3 rounded-full shadow-lg transition-transform hover:scale-105">
                        Atendimento e Suporte
                    </button>
                </div>
            </div>
        </header>

        <!-- Footer -->
        <footer class="bg-azul-escuro text-white/80 py-6">
            <div class="container mx-auto px-6 text-center">
                <div class="flex flex-col items-center gap-4">
                     <p class="text-base font-semibold text-white">Onde tem pessoas, tem Sucesso RH.</p>
                     <div class="flex items-center gap-6">
                        <a href="https://instagram.com/sucessorecursoshumanos" target="_blank" class="text-white/70 hover:text-white transition-colors" aria-label="Instagram">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                        </a>
                        <!-- Botão Ouvidoria -->
                        <a href="https://sucessorh.github.io/ouvidoriasucessorh" id="ouvidoria-link" target="_blank" rel="noopener noreferrer" class="bg-white hover:bg-gray-200 text-azul-escuro font-bold py-2 px-4 rounded-full text-sm transition-colors">
                            Canal de Ouvidoria
                        </a>
                     </div>
                </div>
                <p class="text-xs text-white/50 mt-4">
                    &copy; 2025 Sucesso RH. Todos os direitos reservados.
                </p>
            </div>
        </footer>
    </div>

    <!-- =================================================================== -->
    <!-- ====                  ADMIN DASHBOARD VIEW                     ==== -->
    <!-- =================================================================== -->
    <div id="admin-dashboard" class="hidden min-h-screen bg-slate-100 p-4 sm:p-6 lg:p-8">
        <!-- Admin content will be dynamically generated by JS -->
    </div>

    <!-- =================================================================== -->
    <!-- ====                       MODALS & TOASTS                     ==== -->
    <!-- =================================================================== -->

    <!-- Form Modal 1: Avaliação Geral dos Serviços do Sucesso RH -->
    <div id="geral-servicos-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <form id="geral-servicos-form-element" class="modal-popup bg-white p-8 md:p-10 rounded-2xl shadow-xl border border-gray-100 space-y-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto custom-scrollbar">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-azul-escuro">Pesquisa de Satisfação – Avaliação Geral</h2>
                <p class="mt-2 text-gray-600 max-w-2xl mx-auto">Sua opinião é essencial para que possamos garantir um atendimento ético, seguro e alinhado às boas práticas de compliance no Sucesso RH.</p>
            </div>
            
            <div class="space-y-5">
                <!-- Question Template -->
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">O Sucesso RH cumpre os prazos e acordos feitos com você? <span class="text-red-500">*</span></p>
                    <div class="mt-3 flex justify-around flex-wrap gap-2">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cumpre_prazos" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 1</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cumpre_prazos" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 2</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cumpre_prazos" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 3</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cumpre_prazos" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 4</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cumpre_prazos" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 5</label>
                    </div>
                </div>
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">Você sente que o Sucesso RH atua com transparência nas informações que fornece? <span class="text-red-500">*</span></p>
                    <div class="mt-3 flex justify-around flex-wrap gap-2">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="transparencia" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 1</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="transparencia" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 2</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="transparencia" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 3</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="transparencia" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 4</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="transparencia" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 5</label>
                    </div>
                </div>
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">O atendimento recebido pelo Sucesso RH é cordial e respeitoso? <span class="text-red-500">*</span></p>
                    <div class="mt-3 flex justify-around flex-wrap gap-2">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cordialidade" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 1</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cordialidade" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 2</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cordialidade" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 3</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cordialidade" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 4</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cordialidade" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 5</label>
                    </div>
                </div>
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">As orientações passadas pelo Sucesso RH são claras e fáceis de entender? <span class="text-red-500">*</span></p>
                    <div class="mt-3 flex justify-around flex-wrap gap-2">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="clareza" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 1</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="clareza" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 2</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="clareza" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 3</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="clareza" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 4</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="clareza" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 5</label>
                    </div>
                </div>
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">Você já utilizou o canal de denúncias ou atendimento especial do Sucesso RH? <span class="text-red-500">*</span></p>
                    <div class="mt-3 flex justify-center gap-6">
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="radio" name="usou_canal" value="Sim" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">Sim</span></label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="radio" name="usou_canal" value="Não" class="h-4 w-4 text-azul-medio focus:ring-azul-medio mr-3"><span class="text-sm text-gray-700">Não</span></label>
                    </div>
                </div>
                <div id="efetividade-container" class="p-4 border rounded-lg hidden">
                    <p class="font-semibold text-gray-700">Se sim, como avalia a efetividade da resposta obtida? (opcional)</p>
                    <div class="mt-3 flex justify-around flex-wrap gap-2">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="efetividade_canal" value="1" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 1</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="efetividade_canal" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 2</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="efetividade_canal" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 3</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="efetividade_canal" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 4</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="efetividade_canal" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 5</label>
                    </div>
                </div>
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700 text-center">Qual é o seu nível geral de satisfação com os serviços do Sucesso RH? <span class="text-red-500">*</span></p>
                    <div class="nps-scale mt-3">
                        <script>
                            for(let i = 0; i <= 10; i++) {
                                document.write(`<label><input type="radio" name="nps_geral" value="${i}" required><span class="nps-scale-item">${i}</span></label>`);
                            }
                        </script>
                    </div>
                </div>
            </div>

            <div>
                <label for="comentarios-geral" class="font-semibold text-gray-700">Comentários adicionais (opcional)</label>
                <textarea id="comentarios-geral" rows="3" class="mt-1 block w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-medio focus:border-azul-medio"></textarea>
            </div>
            
            <div class="flex justify-end gap-4 items-center pt-4 border-t border-gray-200">
                <button type="button" class="close-modal-btn font-semibold text-gray-600 hover:text-gray-900">Cancelar</button>
                <button type="submit" class="text-lg font-semibold bg-azul-medio text-white px-8 py-2 rounded-full shadow-lg transition-transform hover:scale-105 disabled:opacity-50 disabled:cursor-wait flex items-center justify-center gap-2">
                    <span class="spinner hidden w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
                    Enviar Avaliação
                </button>
            </div>
        </form>
    </div>

    <!-- Form Modal 2: Avaliação de Atendimento e Suporte do Sucesso RH -->
    <div id="atendimento-suporte-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <form id="atendimento-suporte-form-element" class="modal-popup bg-white p-8 md:p-10 rounded-2xl shadow-xl border border-gray-100 space-y-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto custom-scrollbar">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-azul-escuro">Pesquisa de Satisfação – Atendimento e Suporte</h2>
                <p class="mt-2 text-gray-600 max-w-2xl mx-auto">Avalie como o Sucesso RH está atuando para oferecer suporte, orientação e atendimento de qualidade a você.</p>
            </div>
            
            <div class="space-y-5">
                 <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">Como você avalia a cordialidade no atendimento do Sucesso RH? <span class="text-red-500">*</span></p>
                    <div class="mt-3 flex justify-around flex-wrap gap-2">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cordialidade_atendimento" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 1</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cordialidade_atendimento" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 2</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cordialidade_atendimento" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 3</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cordialidade_atendimento" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 4</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cordialidade_atendimento" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 5</label>
                    </div>
                </div>
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">As suas solicitações ao Sucesso RH são respondidas com agilidade? <span class="text-red-500">*</span></p>
                    <div class="mt-3 flex justify-around flex-wrap gap-2">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="agilidade_resposta" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 1</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="agilidade_resposta" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 2</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="agilidade_resposta" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 3</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="agilidade_resposta" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 4</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="agilidade_resposta" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 5</label>
                    </div>
                </div>
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">O Sucesso RH oferece soluções eficazes para suas necessidades? <span class="text-red-500">*</span></p>
                    <div class="mt-3 flex justify-around flex-wrap gap-2">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="eficacia_solucoes" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 1</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="eficacia_solucoes" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 2</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="eficacia_solucoes" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 3</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="eficacia_solucoes" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 4</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="eficacia_solucoes" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 5</label>
                    </div>
                </div>
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">Você confia nas orientações e informações fornecidas pelo Sucesso RH? <span class="text-red-500">*</span></p>
                    <div class="mt-3 flex justify-around flex-wrap gap-2">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="confianca_orientacoes" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 1</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="confianca_orientacoes" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 2</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="confianca_orientacoes" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 3</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="confianca_orientacoes" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 4</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="confianca_orientacoes" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 5</label>
                    </div>
                </div>
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">O RH demonstra comprometimento em resolver suas demandas de forma justa e ética? <span class="text-red-500">*</span></p>
                    <div class="mt-3 flex justify-around flex-wrap gap-2">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="comprometimento_resolucao" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 1</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="comprometimento_resolucao" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 2</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="comprometimento_resolucao" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 3</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="comprometimento_resolucao" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 4</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="comprometimento_resolucao" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 5</label>
                    </div>
                </div>
                <div class="p-4 border rounded-lg">
                    <p class="font-semibold text-gray-700">Como você avalia a comunicação entre o Sucesso RH e você? <span class="text-red-500">*</span></p>
                    <div class="mt-3 flex justify-around flex-wrap gap-2">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="comunicacao" value="1" required class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 1</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="comunicacao" value="2" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 2</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="comunicacao" value="3" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 3</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="comunicacao" value="4" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 4</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="comunicacao" value="5" class="h-4 w-4 text-azul-medio focus:ring-azul-medio"> 5</label>
                    </div>
                </div>
            </div>

            <div>
                <label for="sugestoes-rh" class="font-semibold text-gray-700">Sugestões para melhoria dos serviços do Sucesso RH (opcional)</label>
                <textarea id="sugestoes-rh" rows="3" class="mt-1 block w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-medio focus:border-azul-medio"></textarea>
            </div>
            
            <div class="flex justify-end gap-4 items-center pt-4 border-t border-gray-200">
                <button type="button" class="close-modal-btn font-semibold text-gray-600 hover:text-gray-900">Cancelar</button>
                <button type="submit" class="text-lg font-semibold bg-azul-medio text-white px-8 py-2 rounded-full shadow-lg transition-transform hover:scale-105 disabled:opacity-50 disabled:cursor-wait flex items-center justify-center gap-2">
                    <span class="spinner hidden w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
                    Enviar Avaliação
                </button>
            </div>
        </form>
    </div>

    <!-- Thank You Modal -->
    <div id="thank-you-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <div class="modal-popup bg-white rounded-2xl shadow-2xl w-full max-w-md text-center p-8">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-5">
                <svg class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>
            </div>
            <h2 class="text-2xl font-bold text-slate-800">Obrigado!</h2>
            <p id="thank-you-message" class="text-slate-600 mt-2 mb-6">Sua opinião foi enviada com sucesso.</p>
            <button class="close-modal-btn w-full bg-azul-medio text-white font-bold px-6 py-3 rounded-lg hover:bg-azul-escuro transition-colors">Fechar</button>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="admin-login-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <form id="admin-login-form" class="modal-popup bg-white rounded-2xl shadow-2xl w-full max-w-sm">
            <div class="p-8">
                <h2 class="text-2xl font-bold text-center text-azul-escuro">Acesso Restrito</h2>
                <p class="text-slate-500 text-center mt-2">Insira a senha de administrador.</p>
                <div class="mt-6">
                    <label for="admin-password" class="font-semibold text-slate-700 block mb-1">Senha</label>
                    <input type="password" id="admin-password" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-azul-medio focus:border-azul-medio">
                    <p id="admin-error" class="text-red-500 text-sm mt-1 hidden">Senha incorreta.</p>
                </div>
                <div class="mt-6 flex items-center justify-end gap-4">
                    <button type="button" class="close-modal-btn font-semibold text-slate-600 hover:text-slate-800">Cancelar</button>
                    <button type="submit" class="bg-azul-medio text-white font-bold px-6 py-2 rounded-lg hover:bg-azul-escuro transition-colors">Entrar</button>
                </div>
            </div>
        </form>
    </div>

    <!-- =================================================================== -->
    <!-- ====                  JAVASCRIPT & FIREBASE                    ==== -->
    <!-- =================================================================== -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // =================================================
        // ===        CREDENCIAIS DO FIREBASE            ===
        // =================================================
        const firebaseConfig = {
          apiKey: "AIzaSyDZdgCapcV-MT-ecMnbBY9BM1rK4MJ6fLU",
          authDomain: "psexternasucessorh.firebaseapp.com",
          projectId: "psexternasucessorh",
          storageBucket: "psexternasucessorh.firebasestorage.app",
          messagingSenderId: "110739482539",
          appId: "1:110739482539:web:6223efe2f79a551a14d4ee",
          measurementId: "G-73B95D0RYB"
        };
        
        // --- DOM Elements ---
        const publicView = document.getElementById('public-view');
        const adminDashboardContainer = document.getElementById('admin-dashboard');
        
        // Modals & Buttons
        const thankYouModal = document.getElementById('thank-you-modal');
        const adminLoginModal = document.getElementById('admin-login-modal');
        const adminLoginForm = document.getElementById('admin-login-form');
        const geralServicosForm = document.getElementById('geral-servicos-form-element');
        const atendimentoSuporteForm = document.getElementById('atendimento-suporte-form-element');
        const openAdminLoginBtn = document.getElementById('open-admin-login-btn');
        const openModalBtns = document.querySelectorAll('.open-modal-btn');
        const closeModalBtns = document.querySelectorAll('.close-modal-btn');

        // Error Banner
        const errorBanner = document.getElementById('error-banner');
        const errorBannerMessage = document.getElementById('error-banner-message');

        function showError(message) {
            errorBannerMessage.textContent = message;
            errorBanner.classList.remove('hidden');
        }

        // --- Firebase Initialization ---
        const isConfigured = firebaseConfig.apiKey && firebaseConfig.apiKey.startsWith("AIza");
        let db, auth;

        if (!isConfigured) {
            showError("CONFIGURAÇÃO NECESSÁRIA: Insira suas credenciais do Firebase no código para a aplicação funcionar.");
        } else {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                signInAnonymously(auth).catch((error) => {
                    console.error("Anonymous sign-in failed:", error);
                    showError("Falha na autenticação. Verifique as regras de segurança do Firebase.");
                });
            } catch (e) {
                console.error("Firebase initialization error:", e);
                showError("Erro ao inicializar o Firebase. Verifique sua configuração.");
            }
        }
        
        // --- UI Logic & Modal Controls ---
        const openModal = (modal) => modal.classList.remove('hidden');
        const closeModal = (modal) => modal.classList.add('hidden');

        openModalBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const modalId = btn.dataset.modal;
                const modal = document.getElementById(modalId);
                if (modal) openModal(modal);
            });
        });
        
        closeModalBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const modal = e.target.closest('.fixed');
                if(modal) closeModal(modal);
            });
        });

        openAdminLoginBtn.addEventListener('click', () => openModal(adminLoginModal));
        
        // Conditional question logic
        const usouCanalRadios = document.querySelectorAll('input[name="usou_canal"]');
        const efetividadeContainer = document.getElementById('efetividade-container');
        usouCanalRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.value === 'Sim') {
                    efetividadeContainer.classList.remove('hidden');
                } else {
                    efetividadeContainer.classList.add('hidden');
                    // Clear optional radio if "No" is selected
                    const efetividadeRadios = document.querySelectorAll('input[name="efetividade_canal"]');
                    efetividadeRadios.forEach(r => r.checked = false);
                }
            });
        });


        // --- Form Submission ---
        async function handleFormSubmission(form, collectionName, dataExtractor, successMessage) {
            if (!isConfigured) {
                showError("O formulário não pode ser enviado sem a configuração do Firebase.");
                return;
            }

            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.querySelector('.spinner').classList.remove('hidden');

            try {
                const formData = dataExtractor(form);
                await addDoc(collection(db, collectionName), formData);
                closeModal(form.closest('.fixed'));
                form.reset();
                efetividadeContainer.classList.add('hidden'); // Reset conditional field
                document.getElementById('thank-you-message').textContent = successMessage;
                openModal(thankYouModal);
            } catch (error) {
                console.error(`Error adding document to ${collectionName}: `, error);
                showError("Ocorreu um erro ao enviar sua resposta. Tente novamente.");
            } finally {
                submitBtn.disabled = false;
                submitBtn.querySelector('.spinner').classList.add('hidden');
            }
        }

        geralServicosForm.addEventListener('submit', (e) => {
            e.preventDefault();
            handleFormSubmission(geralServicosForm, 'pesquisa_geral_servicos', form => {
                const data = {
                    createdAt: serverTimestamp(),
                    cumpre_prazos: parseInt(form.querySelector('input[name="cumpre_prazos"]:checked').value),
                    transparencia: parseInt(form.querySelector('input[name="transparencia"]:checked').value),
                    cordialidade: parseInt(form.querySelector('input[name="cordialidade"]:checked').value),
                    clareza: parseInt(form.querySelector('input[name="clareza"]:checked').value),
                    usou_canal: form.querySelector('input[name="usou_canal"]:checked').value,
                    nps_geral: parseInt(form.querySelector('input[name="nps_geral"]:checked').value),
                    comentarios: form.querySelector('#comentarios-geral').value.trim(),
                };
                const efetividade = form.querySelector('input[name="efetividade_canal"]:checked');
                if (efetividade) {
                    data.efetividade_canal = parseInt(efetividade.value);
                }
                return data;
            }, 'Sua avaliação foi enviada com sucesso. Agradecemos sua contribuição!');
        });

        atendimentoSuporteForm.addEventListener('submit', (e) => {
            e.preventDefault();
            handleFormSubmission(atendimentoSuporteForm, 'pesquisa_atendimento_suporte', form => ({
                createdAt: serverTimestamp(),
                cordialidade_atendimento: parseInt(form.querySelector('input[name="cordialidade_atendimento"]:checked').value),
                agilidade_resposta: parseInt(form.querySelector('input[name="agilidade_resposta"]:checked').value),
                eficacia_solucoes: parseInt(form.querySelector('input[name="eficacia_solucoes"]:checked').value),
                confianca_orientacoes: parseInt(form.querySelector('input[name="confianca_orientacoes"]:checked').value),
                comprometimento_resolucao: parseInt(form.querySelector('input[name="comprometimento_resolucao"]:checked').value),
                comunicacao: parseInt(form.querySelector('input[name="comunicacao"]:checked').value),
                sugestoes: form.querySelector('#sugestoes-rh').value.trim(),
            }), 'Sua avaliação foi enviada com sucesso. Obrigado por nos ajudar a melhorar!');
        });


        // --- Admin Logic ---
        let allGeralData = [];
        let allAtendimentoData = [];
        let filteredGeralData = [];
        let filteredAtendimentoData = [];
        let chartInstances = {};

        function renderAdminDashboard() {
            adminDashboardContainer.innerHTML = `
                <div class="max-w-7xl mx-auto">
                    <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                        <h1 class="text-3xl font-bold text-slate-800">Dashboard de Satisfação</h1>
                        <button id="logout-btn" class="font-semibold text-azul-medio hover:text-azul-escuro transition-colors">Sair</button>
                    </div>

                    <!-- Filters -->
                    <div class="bg-white p-4 rounded-xl shadow-sm mb-6 flex flex-wrap gap-4 items-end">
                        <div>
                            <label for="date-start" class="text-sm font-medium text-gray-600">Data Início</label>
                            <input type="date" id="date-start" class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-medio">
                        </div>
                        <div>
                            <label for="date-end" class="text-sm font-medium text-gray-600">Data Fim</label>
                            <input type="date" id="date-end" class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-azul-medio">
                        </div>
                        <button id="filter-btn" class="bg-azul-medio text-white px-4 py-2 rounded-lg font-semibold hover:bg-azul-escuro transition">Filtrar</button>
                        <button id="clear-filter-btn" class="bg-gray-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-gray-600 transition">Limpar Filtro</button>
                    </div>

                    <!-- Section: Avaliação Geral dos Serviços -->
                    <section class="mb-8 bg-white p-6 rounded-xl shadow-sm">
                        <div class="flex justify-between items-center mb-4 border-b-2 border-azul-medio pb-2">
                            <h2 class="text-2xl font-bold text-slate-700">Avaliação Geral dos Serviços</h2>
                            <button id="export-geral-csv-btn" class="bg-gray-200 text-sm text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300">Exportar CSV</button>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                            <div class="lg:col-span-2">
                                <h3 class="font-bold text-lg text-slate-700 mb-4">Média das Avaliações (1-5)</h3>
                                <div class="h-80"><canvas id="geral-avg-chart"></canvas></div>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg text-slate-700 mb-4">Uso do Canal de Denúncias</h3>
                                <div class="h-80"><canvas id="geral-canal-chart"></canvas></div>
                            </div>
                            <div class="lg:col-span-3">
                                <h3 class="font-bold text-lg text-slate-700 mb-4">NPS - Satisfação Geral com Serviços</h3>
                                <div id="geral-nps-score" class="text-5xl font-bold text-center text-azul-escuro my-4"></div>
                                <div class="h-60"><canvas id="geral-nps-chart"></canvas></div>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg text-slate-700 mb-4">Comentários Adicionais</h3>
                            <div id="geral-comments-list" class="h-72 overflow-y-auto custom-scrollbar space-y-3 pr-2 border p-2 rounded-md"></div>
                        </div>
                    </section>

                    <!-- Section: Avaliação de Atendimento e Suporte -->
                    <section class="bg-white p-6 rounded-xl shadow-sm">
                         <div class="flex justify-between items-center mb-4 border-b-2 border-azul-escuro pb-2">
                            <h2 class="text-2xl font-bold text-slate-700">Avaliação de Atendimento e Suporte</h2>
                            <button id="export-atendimento-csv-btn" class="bg-gray-200 text-sm text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300">Exportar CSV</button>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="lg:col-span-2">
                                <h3 class="font-bold text-lg text-slate-700 mb-4">Média de Avaliação de Atendimento (1-5)</h3>
                                <div class="h-96"><canvas id="atendimento-chart"></canvas></div>
                            </div>
                        </div>
                         <div>
                            <h3 class="font-bold text-lg text-slate-700 mb-4">Sugestões para Melhoria</h3>
                            <div id="atendimento-sugestoes-list" class="h-72 overflow-y-auto custom-scrollbar space-y-3 pr-2 border p-2 rounded-md"></div>
                        </div>
                    </section>
                </div>
            `;
            addAdminEventListeners();
        }

        function addAdminEventListeners() {
            document.getElementById('logout-btn').addEventListener('click', () => {
                publicView.classList.remove('hidden');
                adminDashboardContainer.classList.add('hidden');
                adminDashboardContainer.innerHTML = '';
                Object.values(chartInstances).forEach(chart => chart.destroy());
            });

            document.getElementById('filter-btn').addEventListener('click', applyFilters);
            document.getElementById('clear-filter-btn').addEventListener('click', clearFilters);
            
            document.getElementById('export-geral-csv-btn').addEventListener('click', () => exportGeralToCSV(filteredGeralData));
            document.getElementById('export-atendimento-csv-btn').addEventListener('click', () => exportAtendimentoToCSV(filteredAtendimentoData));
        }

        adminLoginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const password = document.getElementById('admin-password').value;
            const errorMsg = document.getElementById('admin-error');
            if (password === 'SucessoRH@2025') { 
                publicView.classList.add('hidden');
                adminDashboardContainer.classList.remove('hidden');
                closeModal(adminLoginModal);
                adminLoginForm.reset();
                errorMsg.classList.add('hidden');
                renderAdminDashboard();
                initializeDashboard();
            } else {
                errorMsg.classList.add('hidden');
            }
        });

        function initializeDashboard() {
            if (!isConfigured) return;
            
            onSnapshot(query(collection(db, "pesquisa_geral_servicos"), orderBy("createdAt", "desc")), (snapshot) => {
                allGeralData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                applyFilters();
            });
            onSnapshot(query(collection(db, "pesquisa_atendimento_suporte"), orderBy("createdAt", "desc")), (snapshot) => {
                allAtendimentoData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                applyFilters();
            });
        }

        function applyFilters() {
            const startDate = document.getElementById('date-start').value;
            const endDate = document.getElementById('date-end').value;

            const start = startDate ? new Date(startDate) : null;
            if(start) start.setHours(0, 0, 0, 0);

            const end = endDate ? new Date(endDate) : null;
            if(end) end.setHours(23, 59, 59, 999);

            filteredGeralData = allGeralData.filter(item => {
                const itemDate = item.createdAt?.toDate();
                if (!itemDate) return false;
                if (start && itemDate < start) return false;
                if (end && itemDate > end) return false;
                return true;
            });

            filteredAtendimentoData = allAtendimentoData.filter(item => {
                const itemDate = item.createdAt?.toDate();
                if (!itemDate) return false;
                if (start && itemDate < start) return false;
                if (end && itemDate > end) return false;
                return true;
            });
            
            updateDashboard();
        }

        function clearFilters() {
            document.getElementById('date-start').value = '';
            document.getElementById('date-end').value = '';
            applyFilters();
        }

        function updateDashboard() {
            if (adminDashboardContainer.classList.contains('hidden')) return;

            Object.values(chartInstances).forEach(chart => chart.destroy());

            renderGeralAvgChart(filteredGeralData);
            renderGeralCanalChart(filteredGeralData);
            renderGeralNpsChart(filteredGeralData);
            renderCommentsList(filteredGeralData, 'geral-comments-list', 'comentarios');

            renderAtendimentoChart(filteredAtendimentoData);
            renderCommentsList(filteredAtendimentoData, 'atendimento-sugestoes-list', 'sugestoes');
        }

        const createChart = (ctx, type, data, options) => new Chart(ctx, { type, data, options });

        function calculateAverage(data, key) {
            if(data.length === 0) return 0;
            const sum = data.reduce((acc, item) => acc + (item[key] || 0), 0);
            return (sum / data.length).toFixed(2);
        }

        function renderGeralAvgChart(data) {
            const ctx = document.getElementById('geral-avg-chart')?.getContext('2d');
            if(!ctx) return;
            const averages = {
                'Prazos e Acordos': calculateAverage(data, 'cumpre_prazos'),
                'Transparência': calculateAverage(data, 'transparencia'),
                'Cordialidade': calculateAverage(data, 'cordialidade'),
                'Clareza': calculateAverage(data, 'clareza'),
            };
            const chartData = {
                labels: Object.keys(averages),
                datasets: [{
                    label: 'Média',
                    data: Object.values(averages),
                    backgroundColor: ['#1976D2', '#2196F3', '#64B5F6', '#90CAF9'],
                    borderRadius: 5,
                }]
            };
            chartInstances.geralAvg = createChart(ctx, 'bar', chartData, { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, max: 5 } } });
        }

        function renderGeralCanalChart(data) {
            const ctx = document.getElementById('geral-canal-chart')?.getContext('2d');
            if(!ctx) return;
            const counts = data.reduce((acc, item) => {
                acc[item.usou_canal] = (acc[item.usou_canal] || 0) + 1;
                return acc;
            }, { 'Sim': 0, 'Não': 0 });
            const chartData = {
                labels: ['Não', 'Sim'],
                datasets: [{
                    data: [counts['Não'], counts['Sim']],
                    backgroundColor: ['#90CAF9', '#1976D2'],
                }]
            };
            chartInstances.geralCanal = createChart(ctx, 'pie', chartData, { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } });
        }

        function renderGeralNpsChart(data) {
            const ctx = document.getElementById('geral-nps-chart')?.getContext('2d');
            const scoreEl = document.getElementById('geral-nps-score');
            if(!ctx || !scoreEl) return;

            const npsGroups = data.reduce((acc, item) => {
                const score = item.nps_geral;
                if (score >= 9) acc.promotores++;
                else if (score >= 7) acc.neutros++;
                else acc.detratores++;
                return acc;
            }, { promotores: 0, neutros: 0, detratores: 0 });

            const total = data.length;
            const npsScore = total > 0 ? Math.round(((npsGroups.promotores / total) - (npsGroups.detratores / total)) * 100) : 0;
            scoreEl.textContent = `${npsScore}`;
            
            const chartData = {
                labels: ['Detratores (0-6)', 'Neutros (7-8)', 'Promotores (9-10)'],
                datasets: [{
                    label: 'NPS',
                    data: [npsGroups.detratores, npsGroups.neutros, npsGroups.promotores],
                    backgroundColor: ['#EF5350', '#FFEE58', '#42A5F5'],
                    borderRadius: 5,
                }]
            };
            chartInstances.geralNps = createChart(ctx, 'bar', chartData, { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } });
        }
        
        function renderAtendimentoChart(data) {
            const ctx = document.getElementById('atendimento-chart')?.getContext('2d');
            if(!ctx) return;
            const averages = {
                'Cordialidade': calculateAverage(data, 'cordialidade_atendimento'),
                'Agilidade': calculateAverage(data, 'agilidade_resposta'),
                'Eficácia': calculateAverage(data, 'eficacia_solucoes'),
                'Confiança': calculateAverage(data, 'confianca_orientacoes'),
                'Comprometimento': calculateAverage(data, 'comprometimento_resolucao'),
                'Comunicação': calculateAverage(data, 'comunicacao'),
            };
             const chartData = {
                labels: Object.keys(averages),
                datasets: [{
                    label: 'Média',
                    data: Object.values(averages),
                    backgroundColor: 'rgba(30, 136, 229, 0.2)',
                    borderColor: '#1E88E5',
                    pointBackgroundColor: '#1E88E5',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#1E88E5',
                    borderWidth: 2,
                    fill: true
                }]
            };
            chartInstances.atendimento = createChart(ctx, 'radar', chartData, { responsive: true, maintainAspectRatio: false, scales: { r: { beginAtZero: true, max: 5, pointLabels: { font: { size: 14 } } } } });
        }

        function renderCommentsList(data, elementId, key) {
            const list = document.getElementById(elementId);
            if(!list) return;
            const filteredData = data.filter(item => item[key]);
            if (filteredData.length === 0) {
                list.innerHTML = `<p class="text-center text-gray-500">Nenhum registro encontrado.</p>`;
                return;
            }
            list.innerHTML = filteredData
                .map(item => `
                <div class="p-3 bg-slate-50 rounded-lg border border-slate-200">
                    <p class="text-gray-800">"${item[key]}"</p>
                    <div class="mt-2 text-xs text-right text-gray-500">
                        <span>${item.createdAt ? item.createdAt.toDate().toLocaleString('pt-BR') : 'N/A'}</span>
                    </div>
                </div>
            `).join('');
        }

        // --- Export Functions ---
        function exportGeralToCSV(data) {
            const headers = "Data,Cumpriu Prazos,Transparência,Cordialidade,Clareza,Usou Canal,Efetividade Canal,NPS,Comentários";
            const rows = data.map(s => [
                s.createdAt ? s.createdAt.toDate().toLocaleString('pt-BR') : '',
                s.cumpre_prazos, s.transparencia, s.cordialidade, s.clareza,
                s.usou_canal, s.efetividade_canal || 'N/A', s.nps_geral,
                `"${(s.comentarios || '').replace(/"/g, '""')}"`
            ].join(','));
            
            downloadFile(headers + "\n" + rows.join("\n"), "relatorio_geral_servicos.csv", "text/csv;charset=utf-8;");
        }

        function exportAtendimentoToCSV(data) {
            const headers = "Data,Cordialidade,Agilidade,Eficácia,Confiança,Comprometimento,Comunicação,Sugestões";
            const rows = data.map(s => [
                s.createdAt ? s.createdAt.toDate().toLocaleString('pt-BR') : '',
                s.cordialidade_atendimento, s.agilidade_resposta, s.eficacia_solucoes,
                s.confianca_orientacoes, s.comprometimento_resolucao, s.comunicacao,
                `"${(s.sugestoes || '').replace(/"/g, '""')}"`
            ].join(','));
            
            downloadFile(headers + "\n" + rows.join("\n"), "relatorio_atendimento_suporte.csv", "text/csv;charset=utf-8;");
        }

        function downloadFile(content, fileName, mimeType) {
            const link = document.createElement("a");
            const blob = new Blob([content], { type: mimeType });
            link.href = URL.createObjectURL(blob);
            link.setAttribute("download", fileName);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

    </script>
</body>
</html>
